<!DOCTYPE html>

<!-- include mdl -->
<link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
<link rel="stylesheet" href="https://code.getmdl.io/1.3.0/material.indigo-pink.min.css">
<script defer src="https://code.getmdl.io/1.3.0/material.min.js"></script>
<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">


<script src="../threex-arpatternfile.js"></script>

<style media="screen">
	body {
		font-family: arial;
		background-color: #eee;
	}
	h1 {
		text-align: center;
		font-size: 500%;
	}
	div.mdl-cell {
		text-align: center;
	}
	
	h1 a {
		text-decoration: none;
	}
	h1 a:hover {
		text-decoration: underline;
	}
</style>
<body>

<h1><a href='https://github.com/jeromeetienne/ar.js' target='_blank'>AR.js</a> Marker Generator</h1>

<div class="mdl-grid">
	<div class="mdl-cell mdl-cell--2-col"></div>	
	<div class="mdl-cell mdl-cell--4-col">
		<label id='buttonUpload' for="fileinput" class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-button--accent">
			<input type="file" id="fileinput" style='display: none'>
			Upload
		</label>
		<div class="mdl-tooltip" for="buttonUpload">
			Upload the image to put inside the marker
		</div>
	</div>
	<div class="mdl-cell mdl-cell--4-col">
		<button id='buttonDownloadEncoded' class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-button--accent">
			Download
		</button>
		<div class="mdl-tooltip" for="buttonDownloadEncoded">
			Download marker encoded from the uploaded image
		</div>
	</div>
	<div class="mdl-cell mdl-cell--2-col"></div>	
</div>

<div class="mdl-grid">
	<div class="mdl-cell mdl-cell--3-col"></div>
	<div class="mdl-cell mdl-cell--6-col">
		<div id='imageContainer'></div>
	</div>
	<div class="mdl-cell mdl-cell--3-col"></div>
</div>



<script>
	var innerImageURL = null
	var fullMarkerURL = null

	// document.querySelector('#buttonDownloadImage').addEventListener('click', downloadFullMarkerImage)

	document.querySelector('#buttonDownloadEncoded').addEventListener('click', function(){
		if( innerImageURL === null ){
			alert('upload a file first')
			return
		}
		console.assert(innerImageURL)
		THREEx.ArPatternFile.encodeImageURL(innerImageURL, function onComplete(patternFileString){
			THREEx.ArPatternFile.triggerDownload(patternFileString)
		})
	})
	
	document.querySelector('#fileinput').addEventListener('change', function(){
		var file = this.files[0];
		// debugger

		var reader = new FileReader();
		reader.onload = function(event){
			innerImageURL = event.target.result

			THREEx.ArPatternFile.buildFullMarker(innerImageURL, function onComplete(markerUrl){
				fullMarkerURL = markerUrl

				var fullMarkerImage = document.createElement('img')
				fullMarkerImage.src = fullMarkerURL
				
				fullMarkerImage.addEventListener('click', downloadFullMarkerImage)

				// put fullMarkerImage into #imageContainer
				var container = document.querySelector('#imageContainer')
				while (container.firstChild) container.removeChild(container.firstChild);
				container.appendChild(fullMarkerImage)
			})
		};
		reader.readAsDataURL(file);
	})	
	
	function downloadFullMarkerImage(){
		if( innerImageURL === null ){
			alert('upload a file first')
			return
		}
		console.assert(fullMarkerURL)
		var win = window.open(fullMarkerURL, '_blank');
		win.focus();		
	}
</script>

</body>
