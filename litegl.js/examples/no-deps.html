<!-- include ar.js -->
<script src='../src/base/build/build.js'></script>
<script src='../../three.js/build/ar.js'></script>
<script src='../src/litegl-ar.js'></script>
<script>ARjs.Context.baseURL = '../../three.js/'</script> 

<!-- include litescene.js -->
<script src='../vendor/litegl.js/external/gl-matrix-min.js'></script>
<script src='../vendor/litegl.js/build/litegl.js'></script>
<script src='../vendor/litescene.js/build/litescene.js'></script>

<style>
html, body {
	overflow: hidden;
	width: 100%;
	height: 100%;
	margin: 0;
	padding: 0;
	background: rgba(0,0,0,0);
}
</style>
<body><div style='position: absolute; top: 10px; width:100%; text-align: center; z-index: 1;'>
	<a href='https://github.com/jeromeetienne/AR.js/' target='_blank'>AR.js</a> - 
	Support for <a href='https://github.com/jagenjo/litescene.js'>litegl.js/litescene.js</a>
	- by <a href='https://twitter.com/jerome_etienne' target='_blank'>@jerome_etienne</a>
</div><script>

//////////////////////////////////////////////////////////////////////////////
//		create LS.Player
//////////////////////////////////////////////////////////////////////////////
//create context 3D
var player = new LS.Player({
	width: window.innerWidth,
	height: window.innerHeight, 

	resources: '../vendor/litescene.js/examples/assets/', 
	shaders: '../vendor/litescene.js/data/shaders.xml',

	container: document.body,
	redraw: true,
	autoplay: true,
	alpha: true,	// jme- required for seeing the video

	allow_base_files: true
})

//////////////////////////////////////////////////////////////////////////////
//		create a mesh
//////////////////////////////////////////////////////////////////////////////

// mesh
var monitorNode = new LS.SceneNode('monitor')
monitorNode.material = new LS.StandardMaterial({
	textures: {
		color: 'monitor_textura.png'
	}
})
monitorNode.loadAndSetMesh('monitor.obj')
LS.GlobalScene.root.addChild(monitorNode)
LS.GlobalScene.getNode("monitor").transform.rotate(180,[0,1,0])
// node.transform.scale(0.1, 0.1, 0.1)

// some useful controllers
LS.GlobalScene.root.addComponent( new LS.Components.CameraController({rot_speed:0.1}) )
// var interactive = new LS.Components.InteractiveController({mode: LS.Components.InteractiveController.PICKING })
// LS.GlobalScene.root.addComponent( interactive )

//////////////////////////////////////////////////////////////////////////////
//		create camera
//////////////////////////////////////////////////////////////////////////////
// global camera
var globalCamera = LS.GlobalScene.getCamera()

// jme- playing with alpha
// LS.Draw.setAlpha(0.5);

// jme- make the background transparent - to see the video
globalCamera.background_color = [0,0,0,0]

// globalCamera.fov = 22

globalCamera.center = [0,35,0]
globalCamera.eye = [150,40,100]
globalCamera.far = 10000
globalCamera.near = 1

LS.GlobalScene.loadResources(function(){

	LS.GlobalScene.getNode("monitor").transform.scaling = [1/150, 1/150, 1/150]

	player.play()
})

//////////////////////////////////////////////////////////////////////////////
//		Code Separator
//////////////////////////////////////////////////////////////////////////////

// array of functions for the rendering loop
var onRenderFcts= []

player.onUpdate = function(deltaTime){
	// call each update function
	onRenderFcts.forEach(function(onRenderFct){
		onRenderFct(deltaTime, Date.now()/1000)
	})
}
////////////////////////////////////////////////////////////////////////////////
//          	Set up Arjs.Profile
////////////////////////////////////////////////////////////////////////////////
var profilePreset = 'area-artoolkit'

var arProfile = new ARjs.Profile()
	.sourceWebcam()
	.trackingMethod(profilePreset)
	.changeMatrixMode('cameraTransformMatrix')
	.defaultMarker()
	.checkIfValid()


var lARSession = new ARjs.LiteGL.Session(arProfile, player.canvas)
onRenderFcts.push(function(){
	// lARSession.updateProjectionMatrix(babylonCamera)
	lARSession.update()
})

////////////////////////////////////////////////////////////////////////////////
//          Create a ARjs.Anchor
////////////////////////////////////////////////////////////////////////////////
var arAnchor = new ARjs.Anchor(lARSession._arSession, arProfile.defaultMarkerParameters)
onRenderFcts.push(function(){
	var liteglCamera = LS.GlobalScene.getCamera()
	lARSession.updateAnchor(arAnchor, liteglCamera)
})


// add three.js debug
// ARjs.LiteGL._addThreejsDebug(lARSession, arAnchor)

</script></body>
